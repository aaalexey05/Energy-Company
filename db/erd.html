<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERD Ultra - –õ–æ–≥–∏—Å—Ç–∏–∫–∞ 5NF</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0e27;
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        /* Animated background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            opacity: 0.15;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        .header {
            flex-shrink: 0;
            text-align: center;
            padding: 25px 20px 20px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .header-subtitle {
            font-size: 1em;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
        }

        /* Toolbar */
        .toolbar {
            flex-shrink: 0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            background: rgba(10, 14, 39, 0.5);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            flex-wrap: wrap;
        }

        .toolbar-left, .toolbar-right {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-group {
            display: flex;
            gap: 6px;
            background: rgba(255,255,255,0.05);
            padding: 4px;
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn {
            background: transparent;
            color: rgba(255,255,255,0.7);
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
        }

        .btn:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
            transform: translateY(-1px);
        }

        .btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .zoom-control {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.05);
            padding: 8px 16px;
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .zoom-btn {
            background: rgba(102, 126, 234, 0.3);
            border: 1px solid rgba(102, 126, 234, 0.5);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: rgba(102, 126, 234, 0.6);
            transform: scale(1.1);
        }

        .zoom-level {
            font-size: 0.9em;
            font-weight: 700;
            color: #fff;
            min-width: 60px;
            text-align: center;
        }

        .stats-mini {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: rgba(255,255,255,0.7);
        }

        .stats-mini-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Main Layout */
        .main-layout {
            flex: 1;
            display: grid;
            grid-template-columns: 260px 1fr 260px;
            gap: 0;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar-right {
            border-right: none;
            border-left: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-title {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 2em;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.75em;
            color: rgba(255,255,255,0.6);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 4px;
        }

        .info-box {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            padding: 12px;
            border-radius: 10px;
            font-size: 0.8em;
            line-height: 1.5;
            color: rgba(255,255,255,0.7);
        }

        .info-box strong {
            color: #fff;
            display: block;
            margin-bottom: 6px;
        }

        .legend-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 0.8em;
        }

        .legend-item:hover {
            background: rgba(255,255,255,0.05);
            transform: translateX(4px);
        }

        .legend-visual {
            width: 35px;
            height: 20px;
            border-radius: 5px;
            flex-shrink: 0;
            position: relative;
        }

        .legend-line {
            width: 35px;
            height: 3px;
            border-radius: 2px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            flex-shrink: 0;
        }

        /* Canvas Container */
        .canvas-container {
            background: rgba(255,255,255,0.02);
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .canvas-container:active {
            cursor: grabbing;
        }

        .canvas-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            transition: transform 0.2s ease-out;
        }

        .erd-canvas {
            position: relative;
            width: 3200px;
            height: 2600px;
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 40px 40px;
        }

        /* Mini Map */
        .minimap {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 160px;
            background: rgba(10, 14, 39, 0.9);
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            overflow: hidden;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .minimap-canvas {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .minimap-viewport {
            position: absolute;
            border: 2px solid #f093fb;
            background: rgba(240, 147, 251, 0.2);
            pointer-events: none;
            box-shadow: 0 0 10px rgba(240, 147, 251, 0.5);
        }

        .minimap-table {
            position: absolute;
            background: rgba(102, 126, 234, 0.6);
            border-radius: 2px;
        }

        .minimap-table.is-5nf {
            background: rgba(231, 76, 60, 0.6);
        }

        /* Table Cards */
        .table-box {
            position: absolute;
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.8), rgba(42, 82, 152, 0.6));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 14px;
            width: 310px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .table-box:hover {
            transform: scale(1.05);
            box-shadow: 0 16px 48px rgba(102, 126, 234, 0.4);
            z-index: 100;
            border-color: rgba(102, 126, 234, 0.6);
        }

        .table-box.highlight {
            border: 3px solid #f093fb;
            box-shadow: 0 0 40px rgba(240, 147, 251, 0.6);
            z-index: 101;
            transform: scale(1.08);
        }

        .table-box.is-5nf {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.3), rgba(240, 147, 251, 0.3));
            border-color: rgba(231, 76, 60, 0.5);
        }

        .table-header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.6), rgba(118, 75, 162, 0.6));
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .table-box.is-5nf .table-header {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.6), rgba(240, 147, 251, 0.6));
        }

        .table-name {
            font-weight: 700;
            font-size: 0.9em;
            color: #fff;
            letter-spacing: -0.01em;
        }

        .table-badge {
            background: linear-gradient(135deg, #e74c3c, #f093fb);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.65em;
            font-weight: 700;
            text-transform: uppercase;
        }

        .table-pk {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 8px 15px;
            font-size: 0.8em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .table-body {
            max-height: 180px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
        }

        .field-row {
            padding: 8px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 8px;
            font-size: 0.8em;
        }

        .field-row:hover {
            background: rgba(255,255,255,0.05);
        }

        .field-name {
            font-weight: 600;
            color: #fff;
        }

        .field-type {
            color: rgba(255,255,255,0.5);
            font-size: 0.85em;
            font-family: 'Courier New', monospace;
        }

        .sample-data {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.2), rgba(46, 213, 115, 0.2));
            border-top: 1px solid rgba(39, 174, 96, 0.3);
            padding: 10px 15px;
            font-size: 0.75em;
            line-height: 1.4;
            color: rgba(255,255,255,0.8);
        }

        .sample-data strong {
            color: #2ecc71;
        }

        /* Connections */
        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            transform-origin: left center;
            pointer-events: none;
            opacity: 0.6;
            box-shadow: 0 0 8px rgba(79, 172, 254, 0.3);
        }

        .connection-line::after {
            content: '';
            position: absolute;
            right: -6px;
            top: -2.5px;
            width: 0;
            height: 0;
            border-left: 6px solid #00f2fe;
            border-top: 3px solid transparent;
            border-bottom: 3px solid transparent;
        }

        .connection-line.thick {
            height: 4px;
            opacity: 1;
            z-index: 50 !important;
            box-shadow: 0 0 16px rgba(79, 172, 254, 0.8);
        }

        .connection-5nf {
            background: linear-gradient(90deg, #e74c3c, #f093fb) !important;
            height: 3px;
            opacity: 0.8;
            box-shadow: 0 0 12px rgba(231, 76, 60, 0.5);
        }

        .connection-5nf::after {
            border-left-color: #f093fb !important;
        }

        .connection-label {
            position: absolute;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.65em;
            font-weight: 700;
            white-space: nowrap;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.4);
        }

        .connection-label-5nf {
            background: linear-gradient(135deg, #e74c3c, #f093fb) !important;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.02);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .table-box {
            animation: fadeInUp 0.4s ease backwards;
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <div class="container">
        <div class="header">
            <h1>‚ö° ERD Ultra: –õ–æ–≥–∏—Å—Ç–∏–∫–∞ 5NF</h1>
            <p class="header-subtitle">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å –∑—É–º–æ–º –∏ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º</p>
        </div>

        <div class="toolbar">
            <div class="toolbar-left">
                <div class="btn-group">
                    <button class="btn active" onclick="showAll()">üåê –í—Å–µ</button>
                    <button class="btn" onclick="show5NF()">‚ö° 5NF</button>
                    <button class="btn" onclick="showLevel(1)">üìã –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏</button>
                    <button class="btn" onclick="showLevel(3)">üöö –û—Å–Ω–æ–≤–Ω—ã–µ</button>
                </div>
            </div>

            <div class="toolbar-right">
                <div class="zoom-control">
                    <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
                    <div class="zoom-level" id="zoomLevel">100%</div>
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <button class="btn" onclick="resetZoom()">üîÑ –°–±—Ä–æ—Å</button>
                </div>

                <div class="stats-mini">
                    <div class="stats-mini-item">
                        <span>üì¶</span>
                        <span id="visibleTables">17</span>
                    </div>
                    <div class="stats-mini-item">
                        <span>üîó</span>
                        <span id="visibleConnections">23</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <!-- Left Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">17</div>
                            <div class="stat-label">–¢–∞–±–ª–∏—Ü</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">23</div>
                            <div class="stat-label">–°–≤—è–∑–µ–π</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">5NF</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">58+</div>
                            <div class="stat-label">–ò–Ω–¥–µ–∫—Å–æ–≤</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="info-box">
                        <strong>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</strong>
                        ‚Ä¢ <strong>–ö–æ–ª–µ—Å–æ –º—ã—à–∏:</strong> –∑—É–º<br>
                        ‚Ä¢ <strong>Drag:</strong> –ø–∞–Ω–æ—Ä–∞–º–∞<br>
                        ‚Ä¢ <strong>–ö–ª–∏–∫:</strong> –ø–æ–¥—Å–≤–µ—Ç–∫–∞<br>
                        ‚Ä¢ <strong>Hover:</strong> —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="info-box">
                        <strong>üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞</strong>
                        –£—Ä–æ–≤–µ–Ω—å 1: –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (4)<br>
                        –£—Ä–æ–≤–µ–Ω—å 2: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (2)<br>
                        –£—Ä–æ–≤–µ–Ω—å 3: –û—Å–Ω–æ–≤–Ω—ã–µ (5)<br>
                        –£—Ä–æ–≤–µ–Ω—å 4: 5NF (3)<br>
                        –£—Ä–æ–≤–µ–Ω—å 5: –ò—Å—Ç–æ—Ä–∏—è (3)
                    </div>
                </div>
            </div>

            <!-- Canvas -->
            <div class="canvas-container" id="canvasContainer">
                <div class="canvas-wrapper" id="canvasWrapper">
                    <div class="erd-canvas" id="erdCanvas"></div>
                </div>

                <!-- Minimap -->
                <div class="minimap">
                    <div class="minimap-canvas" id="minimapCanvas">
                        <div class="minimap-viewport" id="minimapViewport"></div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="sidebar sidebar-right">
                <div class="sidebar-section">
                    <div class="sidebar-title">üé® –õ–µ–≥–µ–Ω–¥–∞</div>
                    <div class="legend-grid">
                        <div class="legend-item">
                            <div class="legend-visual">
                                <div class="legend-line" style="background: linear-gradient(90deg, #4facfe, #00f2fe);"></div>
                            </div>
                            <span>FK —Å–≤—è–∑—å (1:N)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-visual">
                                <div class="legend-line" style="background: linear-gradient(90deg, #e74c3c, #f093fb); height: 3px;"></div>
                            </div>
                            <span>5NF —Å–≤—è–∑—å (M:N)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background: linear-gradient(135deg, #e74c3c, #c0392b);"></div>
                            <span>–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á üîë</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background: linear-gradient(135deg, #4facfe, #00f2fe);"></div>
                            <span>–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á üîó</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background: linear-gradient(135deg, #f39c12, #f1c40f);"></div>
                            <span>UNIQUE ‚≠ê</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box" style="background: linear-gradient(135deg, rgba(39, 174, 96, 0.3), rgba(46, 213, 115, 0.3)); border: 1px solid #27ae60;"></div>
                            <span>–ü—Ä–∏–º–µ—Ä—ã üí°</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="info-box">
                        <strong>‚ö° 5NF –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è</strong>
                        –¢—Ä–æ–π–Ω–∞—è —Å–≤—è–∑—å –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏:<br><br>
                        –ì–†–£–ó ‚Üî –°–†–ï–î–°–¢–í–û<br>
                        –ì–†–£–ó ‚Üî –ú–ê–†–®–†–£–¢<br>
                        –°–†–ï–î–°–¢–í–û ‚Üî –ú–ê–†–®–†–£–¢
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü - —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –Ω–∞–ª–æ–∂–µ–Ω–∏–π
        const tables = [
            // –£–†–û–í–ï–ù–¨ 1 - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è —Å–≤–µ—Ä—Ö—É
            {id: 'tipos', name: '–¢–ò–ü–´_–°–†–ï–î–°–¢–í_–î–û–°–¢–ê–í–ö–ò', level: 1, x: 100, y: 100, pk: '–∏–¥_—Ç–∏–ø_—Å—Ä–µ–¥—Å—Ç–≤–∞',
                fields: [{name: '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', type: 'VARCHAR(100)', unique: true}, {name: '–≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç—å_–∫–≥', type: 'DECIMAL(10,2)'}, {name: '–æ–±—ä–µ–º_–∫—É–±_–º', type: 'DECIMAL(10,2)'}, {name: '—Ç–æ–ø–ª–∏–≤–æ_—Ç–∏–ø', type: 'VARCHAR(50)'}],
                sample: '–ì–∞–∑–µ–ª—å Next, 1500 –∫–≥, 9 –º¬≥, –±–µ–Ω–∑–∏–Ω'},
            {id: 'goroda', name: '–ì–û–†–û–î–ê', level: 1, x: 540, y: 100, pk: '–∏–¥_–≥–æ—Ä–æ–¥',
                fields: [{name: '–Ω–∞–∑–≤–∞–Ω–∏–µ', type: 'VARCHAR(100)', unique: true}, {name: '—Ä–µ–≥–∏–æ–Ω', type: 'VARCHAR(100)'}, {name: '–Ω–∞—Å–µ–ª–µ–Ω–∏–µ', type: 'INTEGER'}],
                sample: '–ú–æ—Å–∫–≤–∞, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª., 13 –º–ª–Ω'},
            {id: 'klienty', name: '–ö–õ–ò–ï–ù–¢–´', level: 1, x: 980, y: 100, pk: '–∏–¥_–∫–ª–∏–µ–Ω—Ç',
                fields: [{name: '–Ω–∞–∑–≤–∞–Ω–∏–µ', type: 'VARCHAR(200)', unique: true}, {name: '—Ç–∏–ø_–∫–ª–∏–µ–Ω—Ç–∞', type: 'VARCHAR(50)'}, {name: '—Ç–µ–ª–µ—Ñ–æ–Ω', type: 'VARCHAR(20)'}],
                sample: '–û–û–û "–ê–ª—å—Ñ–∞–õ–æ–≥–∏—Å—Ç–∏–∫", –∫–æ–º–ø–∞–Ω–∏—è'},
            {id: 'statusy', name: '–°–¢–ê–¢–£–°–´_–ó–ê–ö–ê–ó–û–í', level: 1, x: 1420, y: 100, pk: '–∏–¥_—Å—Ç–∞—Ç—É—Å',
                fields: [{name: '–∫–æ–¥_—Å—Ç–∞—Ç—É—Å–∞', type: 'VARCHAR(50)', unique: true}, {name: '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', type: 'VARCHAR(100)'}],
                sample: '–≤_–ø—É—Ç–∏, –í –ø—É—Ç–∏'},

            // –£–†–û–í–ï–ù–¨ 2
            {id: 'voditeli', name: '–í–û–î–ò–¢–ï–õ–ò', level: 2, x: 100, y: 500, pk: '–∏–¥_–≤–æ–¥–∏—Ç–µ–ª—å',
                fields: [{name: '—Ñ–∞–º–∏–ª–∏—è', type: 'VARCHAR(50)'}, {name: '–∏–º—è', type: 'VARCHAR(50)'}, {name: '–Ω–æ–º–µ—Ä_–ø—Ä–∞–≤', type: 'VARCHAR(20)', unique: true}],
                sample: '–ò–≤–∞–Ω–æ–≤ –ò.–ò., —Ä–µ–π—Ç–∏–Ω–≥ 4.85'},
            {id: 'sklady', name: '–°–ö–õ–ê–î–´', level: 2, x: 540, y: 500, pk: '–∏–¥_—Å–∫–ª–∞–¥',
                fields: [{name: '–Ω–∞–∑–≤–∞–Ω–∏–µ', type: 'VARCHAR(150)', unique: true}, {name: '–∏–¥_–≥–æ—Ä–æ–¥', type: 'INT', fk: 'goroda'}, {name: '–ø–ª–æ—â–∞–¥—å_–∫–≤_–º', type: 'DECIMAL(12,2)'}],
                sample: '–°–∫–ª–∞–¥ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π, 5000 –º¬≤'},

            // –£–†–û–í–ï–ù–¨ 3 - –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
            {id: 'transport', name: '–¢–†–ê–ù–°–ü–û–†–¢–ù–´–ï_–°–†–ï–î–°–¢–í–ê', level: 3, x: 100, y: 900, pk: '–∏–¥_—Å—Ä–µ–¥—Å—Ç–≤–æ',
                fields: [{name: '–≥–æ—Å–Ω–æ–º–µ—Ä', type: 'VARCHAR(20)', unique: true}, {name: '–∏–¥_—Ç–∏–ø_—Å—Ä–µ–¥—Å—Ç–≤–∞', type: 'INT', fk: 'tipos'}, {name: '–∏–¥_–≤–æ–¥–∏—Ç–µ–ª—å', type: 'INT', fk: 'voditeli'}, {name: '–ø—Ä–æ–±–µ–≥_–∫–º', type: 'INT'}],
                sample: '–ê123–í–°77, 45320 –∫–º'},
            {id: 'gruzy', name: '–ì–†–£–ó–´', level: 3, x: 980, y: 900, pk: '–∏–¥_–≥—Ä—É–∑',
                fields: [{name: '–Ω–æ–º–µ—Ä_–≥—Ä—É–∑–∞', type: 'VARCHAR(50)', unique: true}, {name: '–≤–µ—Å_–∫–≥', type: 'DECIMAL(12,2)'}, {name: '–∏–¥_–∫–ª–∏–µ–Ω—Ç', type: 'INT', fk: 'klienty'}, {name: '–∏–¥_—Å–∫–ª–∞–¥_–æ—Ç–∫—É–¥–∞', type: 'INT', fk: 'sklady'}, {name: '–∏–¥_—Å—Ç–∞—Ç—É—Å', type: 'INT', fk: 'statusy'}],
                sample: 'GRZ-2026-0001, 1247.5 –∫–≥'},
            {id: 'marshruty', name: '–ú–ê–†–®–†–£–¢–´', level: 3, x: 1420, y: 900, pk: '–∏–¥_–º–∞—Ä—à—Ä—É—Ç',
                fields: [{name: '–∫–æ–¥_–º–∞—Ä—à—Ä—É—Ç–∞', type: 'VARCHAR(50)', unique: true}, {name: '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', type: 'VARCHAR(100)'}, {name: '—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–∫–º', type: 'DECIMAL(10,2)'}],
                sample: 'M00001, –ú–æ—Å–∫–≤–∞‚Üí–ö–∞–∑–∞–Ω—å, 820 –∫–º'},
            {id: 'ostanovki', name: '–û–°–¢–ê–ù–û–í–ö–ò_–ú–ê–†–®–†–£–¢–ê', level: 3, x: 1860, y: 900, pk: '–∏–¥_–æ—Å—Ç–∞–Ω–æ–≤–∫–∞',
                fields: [{name: '–∏–¥_–º–∞—Ä—à—Ä—É—Ç', type: 'INT', fk: 'marshruty'}, {name: '–∏–¥_–≥–æ—Ä–æ–¥', type: 'INT', fk: 'goroda'}, {name: '–ø–æ—Ä—è–¥–∫–æ–≤—ã–π_–Ω–æ–º–µ—Ä', type: 'INT'}],
                sample: '–ú–∞—Ä—à—Ä—É—Ç M00001, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ 1'},
            {id: 'platezhi', name: '–ü–õ–ê–¢–ï–ñ–ò', level: 3, x: 540, y: 1300, pk: '–∏–¥_–ø–ª–∞—Ç–µ–∂',
                fields: [{name: '–Ω–æ–º–µ—Ä_–ø–ª–∞—Ç–µ–∂–∞', type: 'VARCHAR(50)', unique: true}, {name: '–∏–¥_–∫–ª–∏–µ–Ω—Ç', type: 'INT', fk: 'klienty'}, {name: '–∏–¥_–≥—Ä—É–∑', type: 'INT', fk: 'gruzy'}, {name: '—Å—É–º–º–∞_—Ä—É–±', type: 'DECIMAL(12,2)'}],
                sample: 'PAY-001, 28700 —Ä—É–±, –æ–ø–ª–∞—á–µ–Ω'},

            // –£–†–û–í–ï–ù–¨ 4 - 5NF —Ç–∞–±–ª–∏—Ü—ã
            {id: 'gruz_sredstva', name: '–ì–†–£–ó_–ò_–°–†–ï–î–°–¢–í–ê', level: 4, is5nf: true, x: 440, y: 1700, pk: '–∏–¥_–≥—Ä—É–∑_—Å—Ä–µ–¥—Å—Ç–≤–æ',
                fields: [{name: '–∏–¥_–≥—Ä—É–∑', type: 'INT', fk: 'gruzy'}, {name: '–∏–¥_—Å—Ä–µ–¥—Å—Ç–≤–æ', type: 'INT', fk: 'transport'}, {name: '–ø—Ä–æ–π–¥–µ–Ω–æ_–∫–º', type: 'DECIMAL(10,2)'}],
                sample: 'GRZ-001 ‚Üí –ê123–í–°77, 350 –∫–º'},
            {id: 'gruz_marshruty', name: '–ì–†–£–ó_–ò_–ú–ê–†–®–†–£–¢–´', level: 4, is5nf: true, x: 980, y: 1700, pk: '–∏–¥_–≥—Ä—É–∑_–º–∞—Ä—à—Ä—É—Ç',
                fields: [{name: '–∏–¥_–≥—Ä—É–∑', type: 'INT', fk: 'gruzy'}, {name: '–∏–¥_–º–∞—Ä—à—Ä—É—Ç', type: 'INT', fk: 'marshruty'}, {name: '—Å—Ç–∞—Ç—É—Å', type: 'VARCHAR(20)'}],
                sample: 'GRZ-001 ‚Üí M00001, –∞–∫—Ç–∏–≤–µ–Ω'},
            {id: 'sredstvo_marshruty', name: '–°–†–ï–î–°–¢–í–û_–ò_–ú–ê–†–®–†–£–¢–´', level: 4, is5nf: true, x: 1520, y: 1700, pk: '–∏–¥_—Å—Ä–µ–¥—Å—Ç–≤–æ_–º–∞—Ä—à—Ä—É—Ç',
                fields: [{name: '–∏–¥_—Å—Ä–µ–¥—Å—Ç–≤–æ', type: 'INT', fk: 'transport'}, {name: '–∏–¥_–º–∞—Ä—à—Ä—É—Ç', type: 'INT', fk: 'marshruty'}, {name: '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Ä–µ–π—Å–æ–≤', type: 'INT'}],
                sample: '–ê123–í–°77 ‚Üí M00001, 15 —Ä–µ–π—Å–æ–≤'},

            // –£–†–û–í–ï–ù–¨ 5
            {id: 'istoria', name: '–ò–°–¢–û–†–ò–Ø_–°–¢–ê–¢–£–°–û–í', level: 5, x: 1420, y: 1300, pk: '–∏–¥_–∏—Å—Ç–æ—Ä–∏—è',
                fields: [{name: '–∏–¥_–≥—Ä—É–∑', type: 'INT', fk: 'gruzy'}, {name: '–∏–¥_—Å—Ç–∞—Ç—É—Å_–Ω–æ–≤—ã–π', type: 'INT', fk: 'statusy'}],
                sample: 'GRZ-001: –Ω–æ–≤—ã–π‚Üí–≤_–ø—É—Ç–∏'},
            {id: 'rashody', name: '–†–ê–°–•–û–î–´_–¢–û–ü–õ–ò–í–ê', level: 5, x: 100, y: 1300, pk: '–∏–¥_—Ä–∞—Å—Ö–æ–¥',
                fields: [{name: '–∏–¥_—Å—Ä–µ–¥—Å—Ç–≤–æ', type: 'INT', fk: 'transport'}, {name: '–æ–±—ä–µ–º_–ª', type: 'DECIMAL(10,2)'}, {name: '—Å—Ç–æ–∏–º–æ—Å—Ç—å_—Ä—É–±', type: 'DECIMAL(10,2)'}],
                sample: '45 –ª, 2475 —Ä—É–±'},
            {id: 'tech_obsluzhivanie', name: '–¢–ï–•_–û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï', level: 5, x: 100, y: 1700, pk: '–∏–¥_—Ç–æ',
                fields: [{name: '–∏–¥_—Å—Ä–µ–¥—Å—Ç–≤–æ', type: 'INT', fk: 'transport'}, {name: '—Ç–∏–ø', type: 'VARCHAR(100)'}, {name: '—Å—Ç–æ–∏–º–æ—Å—Ç—å_—Ä—É–±', type: 'DECIMAL(12,2)'}],
                sample: '–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û, 8500 —Ä—É–±'}
        ];

        const connections = [
            {from: 'tipos', to: 'transport', label: 'FK: —Ç–∏–ø'},
            {from: 'goroda', to: 'sklady', label: 'FK: –≥–æ—Ä–æ–¥'},
            {from: 'goroda', to: 'ostanovki', label: 'FK: –≥–æ—Ä–æ–¥'},
            {from: 'klienty', to: 'gruzy', label: 'FK: –∫–ª–∏–µ–Ω—Ç'},
            {from: 'klienty', to: 'platezhi', label: 'FK: –∫–ª–∏–µ–Ω—Ç'},
            {from: 'statusy', to: 'gruzy', label: 'FK: —Å—Ç–∞—Ç—É—Å'},
            {from: 'statusy', to: 'istoria', label: 'FK: —Å—Ç–∞—Ç—É—Å'},
            {from: 'voditeli', to: 'transport', label: 'FK: –≤–æ–¥–∏—Ç–µ–ª—å'},
            {from: 'sklady', to: 'gruzy', label: 'FK: —Å–∫–ª–∞–¥'},
            {from: 'marshruty', to: 'ostanovki', label: 'FK: –º–∞—Ä—à—Ä—É—Ç'},
            {from: 'gruzy', to: 'platezhi', label: 'FK: –≥—Ä—É–∑'},
            {from: 'gruzy', to: 'istoria', label: 'FK: –≥—Ä—É–∑'},
            {from: 'transport', to: 'rashody', label: 'FK: —Å—Ä–µ–¥—Å—Ç–≤–æ'},
            {from: 'transport', to: 'tech_obsluzhivanie', label: 'FK: —Å—Ä–µ–¥—Å—Ç–≤–æ'},
            {from: 'gruzy', to: 'gruz_sredstva', label: '5NF: –ì–†–£–ó', is5nf: true},
            {from: 'transport', to: 'gruz_sredstva', label: '5NF: –°–†–ï–î–°–¢–í–û', is5nf: true},
            {from: 'gruzy', to: 'gruz_marshruty', label: '5NF: –ì–†–£–ó', is5nf: true},
            {from: 'marshruty', to: 'gruz_marshruty', label: '5NF: –ú–ê–†–®–†–£–¢', is5nf: true},
            {from: 'transport', to: 'sredstvo_marshruty', label: '5NF: –°–†–ï–î–°–¢–í–û', is5nf: true},
            {from: 'marshruty', to: 'sredstvo_marshruty', label: '5NF: –ú–ê–†–®–†–£–¢', is5nf: true}
        ];

        // Zoom & Pan
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX = 0;
        let startY = 0;

        function createTable(table) {
            const div = document.createElement('div');
            div.className = 'table-box' + (table.is5nf ? ' is-5nf' : '');
            div.id = table.id;
            div.style.left = table.x + 'px';
            div.style.top = table.y + 'px';

            let html = `
                <div class="table-header">
                    <span class="table-name">${table.name}</span>
                    ${table.is5nf ? '<span class="table-badge">5NF</span>' : ''}
                </div>
                <div class="table-pk">üîë ${table.pk}</div>
                <div class="table-body">
            `;

            table.fields.forEach(field => {
                const icon = field.fk ? 'üîó' : (field.unique ? '‚≠ê' : '');
                html += `
                    <div class="field-row">
                        <div class="field-name">${field.name} ${icon}</div>
                        <div class="field-type">${field.type}</div>
                    </div>
                `;
            });

            html += `</div><div class="sample-data"><strong>üí°</strong> ${table.sample}</div>`;
            div.innerHTML = html;
            div.onclick = (e) => { e.stopPropagation(); highlightTable(table.id); };
            return div;
        }

        function drawConnection(from, to, label, is5nf = false) {
            const fromEl = document.getElementById(from);
            const toEl = document.getElementById(to);
            if (!fromEl || !toEl) return;

            const fromRect = fromEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();
            const canvas = document.getElementById('erdCanvas');

            const x1 = parseFloat(fromEl.style.left) + 155;
            const y1 = parseFloat(fromEl.style.top) + fromEl.offsetHeight / 2;
            const x2 = parseFloat(toEl.style.left) + 155;
            const y2 = parseFloat(toEl.style.top) + toEl.offsetHeight / 2;

            const length = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));
            const angle = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;

            const line = document.createElement('div');
            line.className = 'connection-line' + (is5nf ? ' connection-5nf' : '');
            line.style.left = x1 + 'px';
            line.style.top = y1 + 'px';
            line.style.width = length + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            line.dataset.from = from;
            line.dataset.to = to;

            const labelEl = document.createElement('div');
            labelEl.className = 'connection-label' + (is5nf ? ' connection-label-5nf' : '');
            labelEl.textContent = label;
            labelEl.style.left = (x1 + x2)/2 + 'px';
            labelEl.style.top = (y1 + y2)/2 - 10 + 'px';
            labelEl.dataset.from = from;
            labelEl.dataset.to = to;

            canvas.appendChild(line);
            canvas.appendChild(labelEl);
        }

        function init() {
            const canvas = document.getElementById('erdCanvas');
            tables.forEach(table => canvas.appendChild(createTable(table)));
            setTimeout(() => {
                connections.forEach(conn => drawConnection(conn.from, conn.to, conn.label, conn.is5nf));
                createMinimap();
            }, 100);

            setupZoomPan();
        }

        function setupZoomPan() {
            const container = document.getElementById('canvasContainer');
            const wrapper = document.getElementById('canvasWrapper');

            // Wheel zoom
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -0.1 : 0.1;
                const newScale = Math.max(0.3, Math.min(2, scale + delta));

                const rect = container.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const dx = x - translateX;
                const dy = y - translateY;

                translateX = x - dx * (newScale / scale);
                translateY = y - dy * (newScale / scale);
                scale = newScale;

                updateTransform();
            });

            // Drag pan
            container.addEventListener('mousedown', (e) => {
                if (e.target === container || e.target.id === 'canvasWrapper' || e.target.id === 'erdCanvas') {
                    isDragging = true;
                    startX = e.clientX - translateX;
                    startY = e.clientY - translateY;
                    container.style.cursor = 'grabbing';
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    translateX = e.clientX - startX;
                    translateY = e.clientY - startY;
                    updateTransform();
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                container.style.cursor = 'grab';
            });
        }

        function updateTransform() {
            const wrapper = document.getElementById('canvasWrapper');
            wrapper.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
            document.getElementById('zoomLevel').textContent = Math.round(scale * 100) + '%';
            updateMinimap();
        }

        function zoomIn() {
            scale = Math.min(2, scale + 0.2);
            updateTransform();
        }

        function zoomOut() {
            scale = Math.max(0.3, scale - 0.2);
            updateTransform();
        }

        function resetZoom() {
            scale = 1;
            translateX = 0;
            translateY = 0;
            updateTransform();
        }

        function createMinimap() {
            const minimapCanvas = document.getElementById('minimapCanvas');
            const scaleX = 200 / 3200;
            const scaleY = 160 / 2600;

            tables.forEach(table => {
                const dot = document.createElement('div');
                dot.className = 'minimap-table' + (table.is5nf ? ' is-5nf' : '');
                dot.style.left = (table.x * scaleX) + 'px';
                dot.style.top = (table.y * scaleY) + 'px';
                dot.style.width = (310 * scaleX) + 'px';
                dot.style.height = (15) + 'px';
                minimapCanvas.appendChild(dot);
            });
        }

        function updateMinimap() {
            const container = document.getElementById('canvasContainer');
            const viewport = document.getElementById('minimapViewport');
            const scaleX = 200 / 3200;
            const scaleY = 160 / 2600;

            const viewWidth = container.clientWidth / scale;
            const viewHeight = container.clientHeight / scale;

            viewport.style.left = (-translateX / scale * scaleX) + 'px';
            viewport.style.top = (-translateY / scale * scaleY) + 'px';
            viewport.style.width = (viewWidth * scaleX) + 'px';
            viewport.style.height = (viewHeight * scaleY) + 'px';
        }

        function showAll() {
            document.querySelectorAll('.table-box').forEach(el => el.style.display = 'block');
            document.querySelectorAll('.connection-line, .connection-label').forEach(el => el.style.display = 'block');
            updateStats(17, 23);
            setActiveBtn(0);
        }

        function show5NF() {
            const nfIds = ['gruz_sredstva', 'gruz_marshruty', 'sredstvo_marshruty', 'gruzy', 'transport', 'marshruty'];
            document.querySelectorAll('.table-box').forEach(el => {
                el.style.display = nfIds.includes(el.id) ? 'block' : 'none';
            });
            document.querySelectorAll('.connection-line, .connection-label').forEach(el => {
                el.style.display = el.classList.contains('connection-5nf') ? 'block' : 'none';
            });
            updateStats(6, 6);
            setActiveBtn(1);
        }

        function showLevel(level) {
            let count = 0;
            document.querySelectorAll('.table-box').forEach(el => {
                const table = tables.find(t => t.id === el.id);
                if (table && table.level === level) {
                    el.style.display = 'block';
                    count++;
                } else {
                    el.style.display = 'none';
                }
            });
            document.querySelectorAll('.connection-line, .connection-label').forEach(el => el.style.display = 'none');
            updateStats(count, 0);
            setActiveBtn(level === 1 ? 2 : 3);
        }

        function highlightTable(tableId) {
            document.querySelectorAll('.table-box').forEach(el => el.classList.remove('highlight'));
            document.getElementById(tableId)?.classList.add('highlight');

            document.querySelectorAll('.connection-line').forEach(line => {
                if (line.dataset.from === tableId || line.dataset.to === tableId) {
                    line.classList.add('thick');
                } else {
                    line.classList.remove('thick');
                }
            });
        }

        function updateStats(tablesCount, connectionsCount) {
            document.getElementById('visibleTables').textContent = tablesCount;
            document.getElementById('visibleConnections').textContent = connectionsCount;
        }

        function setActiveBtn(index) {
            document.querySelectorAll('.btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        window.onload = init;
    </script>
</body>
</html>
